<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sanctuary Study</title>
  <meta name="description" content="A Christian-themed Pomodoro study app with scripture encouragement, analytics, achievements, and focus modes. Stay productive and spiritually grounded." />
  <meta property="og:title" content="Sanctuary Study" />
  <meta property="og:description" content="A Christian-themed Pomodoro study app with scripture encouragement, analytics, achievements, and focus modes." />
  <meta property="og:type" content="website" />
  <link rel="icon" type="image/png" sizes="32x32" href="./favicon-32x32.png?v=8" />
  <link rel="icon" type="image/png" sizes="16x16" href="./favicon-16x16.png?v=8" />
  <link rel="shortcut icon" href="./favicon.ico?v=8" />
  <link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png?v=8" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@500;600;700&family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="./style.css?v=20260221-ios-fix2" />
</head>
<body data-theme="dark">
  <script>
    (() => {
      const themes = ["dark", "light", "dawn", "ocean", "sage"];
      const safeLocalStorageGet = (key) => {
        try {
          return localStorage.getItem(key);
        } catch (error) {
          return "";
        }
      };
      const normalizeTheme = (value) => {
        const raw = String(value || "").trim().toLowerCase();
        if (!raw) {
          return "";
        }
        const aliasMap = {
          "theme-dark": "dark",
          "theme-light": "light",
          "theme-dawn": "dawn",
          "theme-ocean": "ocean",
          "theme-sage": "sage",
          "mode-dark": "dark",
          "mode-light": "light"
        };
        const resolved = aliasMap[raw] || raw.replace(/^theme:\s*/i, "");
        return themes.includes(resolved) ? resolved : "";
      };

      let initialTheme = normalizeTheme(safeLocalStorageGet("theme"));

      if (!initialTheme) {
        try {
          const parsed = JSON.parse(safeLocalStorageGet("sanctuaryStudySettingsV1") || "{}");
          initialTheme = normalizeTheme(parsed.theme);
        } catch (error) {
          initialTheme = "";
        }
      }

      const theme = initialTheme || "dark";
      document.body.dataset.theme = theme;
      themes.forEach((themeId) => {
        document.body.classList.remove(`theme-${themeId}`);
      });
      document.body.classList.add(`theme-${theme}`);
    })();
  </script>
  <main class="app-shell">
    <header class="top-bar">
      <div class="top-left-controls">
        <div id="logoHomeBtn" class="app-logo-btn" role="button" tabindex="0" aria-label="Sanctuary Study home">
          <span class="app-logo-mark" aria-hidden="true">
            <svg viewBox="0 0 24 24" class="icon-svg" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 3v18M6 9l6-6 6 6" />
              <path d="M7 16c1.2-2.3 3-3.6 5-3.6s3.8 1.3 5 3.6" />
            </svg>
          </span>
          <span class="app-logo-text">
            <strong>Sanctuary</strong>
            <small>Study</small>
          </span>
        </div>

        <button id="homeNavBtn" class="home-nav-btn" type="button" aria-label="Go to home">
          <span class="icon-wrap" aria-hidden="true">
            <svg viewBox="0 0 24 24" class="icon-svg" fill="none" stroke="currentColor" stroke-width="2">
              <path d="m3 10 9-7 9 7" />
              <path d="M5 10v10h14V10" />
            </svg>
          </span>
          <span>Home</span>
        </button>

        <button id="theme-toggle" class="theme-toggle" type="button" aria-label="Cycle color theme">
          <span id="themeToggleIcon" class="icon-wrap" aria-hidden="true">
            <svg viewBox="0 0 24 24" class="icon-svg" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 3v2m0 14v2m9-9h-2M5 12H3m15.36 6.36-1.42-1.42M7.05 7.05 5.64 5.64m12.72 0-1.42 1.41M7.05 16.95l-1.41 1.41" />
              <circle cx="12" cy="12" r="4" />
            </svg>
          </span>
          <span id="themeToggleText">Theme: Midnight</span>
        </button>

        <button id="authActionBtn" class="home-nav-btn" type="button" aria-label="Sign in or sign out">
          <span class="icon-wrap" aria-hidden="true">
            <svg viewBox="0 0 24 24" class="icon-svg" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
              <circle cx="12" cy="7" r="4" />
            </svg>
          </span>
          <span id="authActionText">Sign In</span>
        </button>
      </div>

      <nav class="top-nav" aria-label="Main sections">
        <button class="nav-btn" data-section="study" type="button">
          <span class="icon-wrap" aria-hidden="true">
            <svg viewBox="0 0 24 24" class="icon-svg" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.74.44L12 16.5l-7.26 3.44A.5.5 0 0 1 4 19.5z" />
            </svg>
          </span>
          <span>Study</span>
        </button>
        <button class="nav-btn" data-section="analytics" type="button">
          <span class="icon-wrap" aria-hidden="true">
            <svg viewBox="0 0 24 24" class="icon-svg" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 19h16M7 15v-4m5 4V7m5 8v-6" />
            </svg>
          </span>
          <span>Analytics</span>
        </button>
        <button class="nav-btn" data-section="settings" type="button">
          <span class="icon-wrap" aria-hidden="true">
            <svg viewBox="0 0 24 24" class="icon-svg" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="3.5" />
              <path d="M19.4 15a1.7 1.7 0 0 0 .34 1.87l.03.03a2 2 0 0 1-2.83 2.83l-.03-.03A1.7 1.7 0 0 0 15 19.4a1.7 1.7 0 0 0-1 .6 1.7 1.7 0 0 0-.4 1.08V21a2 2 0 0 1-4 0v-.05a1.7 1.7 0 0 0-.4-1.08 1.7 1.7 0 0 0-1-.6 1.7 1.7 0 0 0-1.87.34l-.03.03a2 2 0 0 1-2.83-2.83l.03-.03A1.7 1.7 0 0 0 4.6 15a1.7 1.7 0 0 0-.6-1 1.7 1.7 0 0 0-1.08-.4H3a2 2 0 0 1 0-4h.05a1.7 1.7 0 0 0 1.08-.4 1.7 1.7 0 0 0 .6-1 1.7 1.7 0 0 0-.34-1.87l-.03-.03a2 2 0 1 1 2.83-2.83l.03.03A1.7 1.7 0 0 0 9 4.6a1.7 1.7 0 0 0 1-.6 1.7 1.7 0 0 0 .4-1.08V3a2 2 0 0 1 4 0v.05a1.7 1.7 0 0 0 .4 1.08 1.7 1.7 0 0 0 1 .6 1.7 1.7 0 0 0 1.87-.34l.03-.03a2 2 0 0 1 2.83 2.83l-.03.03A1.7 1.7 0 0 0 19.4 9a1.7 1.7 0 0 0 .6 1 1.7 1.7 0 0 0 1.08.4H21a2 2 0 0 1 0 4h-.05a1.7 1.7 0 0 0-1.08.4 1.7 1.7 0 0 0-.47.6z" />
            </svg>
          </span>
          <span>Settings</span>
        </button>
        <button class="nav-btn" data-section="favourites" type="button">
          <span class="icon-wrap" aria-hidden="true">
            <svg viewBox="0 0 24 24" class="icon-svg" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 21s-7-4.35-9.1-8.14A5.3 5.3 0 0 1 12 4.5a5.3 5.3 0 0 1 9.1 8.36C19 16.65 12 21 12 21z" />
            </svg>
          </span>
          <span>Sanctuary</span>
        </button>
      </nav>
    </header>

    <section id="authSection" class="auth-gate card hidden">
      <p class="kicker fade-up">WELCOME</p>
      <h1 class="auth-title">Sanctuary Study</h1>
      <p class="auth-copy">
        Sign in to save analytics and achievements. You can also continue as a guest
        to use the study timer without account progress tracking.
      </p>

      <form id="authForm" class="auth-form" autocomplete="on">
        <div class="auth-form-row">
          <label>
            First name
            <input id="authFirstNameInput" type="text" autocomplete="given-name" placeholder="First name" />
          </label>
          <label>
            Surname
            <input id="authLastNameInput" type="text" autocomplete="family-name" placeholder="Surname" />
          </label>
        </div>
        <label>
          Email
          <input id="authEmailInput" type="email" autocomplete="email" placeholder="you@example.com" />
        </label>
        <label>
          Date of birth
          <input id="authDobInput" type="date" autocomplete="bday" />
        </label>
        <label>
          Password
          <input id="authPasswordInput" type="password" autocomplete="current-password" placeholder="At least 8 chars, upper/lower, number, special" />
        </label>
        <button id="authSubmitBtn" class="btn btn-primary auth-submit-btn" type="submit">Submit Sign In</button>
      </form>
      <p class="auth-inline-note">First name, surname, and date of birth are required only for sign up.</p>

      <div class="auth-gate-actions">
        <button id="authSignInBtn" class="btn btn-primary" type="button">Sign In</button>
        <button id="authSignUpBtn" class="btn btn-glass" type="button">Sign Up</button>
        <button id="authGoogleBtn" class="btn btn-glass" type="button">
          <span class="icon-wrap" aria-hidden="true">
            <svg viewBox="0 0 24 24" class="icon-svg" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 12h8.4c.1.6.1 1.2.1 1.8 0 5.1-3.4 8.7-8.5 8.7A9.5 9.5 0 0 1 2.5 12 9.5 9.5 0 0 1 12 2.5c2.4 0 4.5.8 6.2 2.3l-2.7 2.6A5.6 5.6 0 0 0 12 6c-3.3 0-6 2.7-6 6s2.7 6 6 6c2.8 0 5-1.6 5.6-4H12z" />
            </svg>
          </span>
          Sign in with Google
        </button>
        <button id="authGuestBtn" class="btn btn-glass" type="button">Continue as Guest</button>
      </div>
      <button id="authResendVerificationBtn" class="btn btn-glass auth-resend-btn hidden" type="button">
        Resend verification email
      </button>
      <div id="authLoading" class="auth-loading hidden" role="status" aria-live="polite" aria-hidden="true">
        <span class="auth-spinner" aria-hidden="true"></span>
        <span id="authLoadingText">Processing request...</span>
      </div>

      <p class="auth-note">Guest mode can run study sessions, but analytics and achievements are locked until sign-in.</p>
      <p id="authMessage" class="settings-message" role="status" aria-live="polite"></p>
    </section>

    <section id="homeSection" class="home-hero card">
      <p class="kicker fade-up">WELCOME</p>
      <h1 class="type-title">Sanctuary Study</h1>
      <p class="home-copy fade-up delay-1">
        Build a daily study rhythm with focus, Scripture, and peace.
        Begin now or shape your setup first.
      </p>
      <p id="authModeNotice" class="auth-mode-notice hidden"></p>
      <div class="home-actions fade-up delay-2">
        <button id="homeBeginBtn" class="btn btn-primary" type="button">Begin Study</button>
        <button id="homeSettingsBtn" class="btn btn-glass" type="button">Change Settings</button>
      </div>

      <div class="theme-picker fade-up delay-2">
        <p>Study Theme</p>
        <div id="themePills" class="theme-pill-group" role="radiogroup" aria-label="Study Theme">
          <button class="theme-pill active" type="button" data-study-theme="Perseverance">Perseverance</button>
          <button class="theme-pill" type="button" data-study-theme="Peace">Peace</button>
          <button class="theme-pill" type="button" data-study-theme="Wisdom">Wisdom</button>
          <button class="theme-pill" type="button" data-study-theme="Gratitude">Gratitude</button>
        </div>
      </div>

      <article class="home-focus-card fade-up delay-2">
        <div class="home-focus-head">
          <p id="homeThemeBadge" class="home-theme-badge">Perseverance</p>
          <button id="homeSaveVerseBtn" class="save-btn" type="button" aria-label="Save current verse to favourites">
            <span class="icon-wrap" aria-hidden="true">
              <svg viewBox="0 0 24 24" class="icon-svg" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 21s-7-4.35-9.1-8.14A5.3 5.3 0 0 1 12 4.5a5.3 5.3 0 0 1 9.1 8.36C19 16.65 12 21 12 21z" />
              </svg>
            </span>
            <span>Save</span>
          </button>
        </div>
        <blockquote id="homeVerseText" class="scripture-text"></blockquote>
        <p id="homeVerseRef" class="scripture-ref"></p>
        <p id="homeEncouragementText" class="home-encouragement"></p>
      </article>

      <article class="daily-scripture-card fade-up delay-2">
        <p class="quote-label">Scripture for Today</p>
        <blockquote id="dailyVerseText" class="scripture-text"></blockquote>
        <p id="dailyVerseRef" class="scripture-ref"></p>
      </article>
    </section>

    <section id="studySection" class="panel card hidden">
      <div id="studyPrep" class="study-prep">
        <h2>Ready to focus?</h2>
        <p>Choose begin to show a random scripture. After 5 seconds, your study session starts automatically.</p>

        <div class="preset-wrap">
          <p class="quote-label">Focus Presets</p>
          <div id="presetButtons" class="preset-buttons">
            <button class="preset-btn active" type="button" data-preset="25-5">25/5</button>
            <button class="preset-btn" type="button" data-preset="50-10">50/10</button>
            <button class="preset-btn" type="button" data-preset="90-15">90/15</button>
            <button class="preset-btn" type="button" data-preset="custom">Custom</button>
          </div>
          <div id="customPresetFields" class="custom-preset-fields hidden">
            <label>
              Study min
              <input id="customStudyMinutes" type="number" min="1" max="240" value="30" />
            </label>
            <label>
              Break min
              <input id="customBreakMinutes" type="number" min="1" max="120" value="10" />
            </label>
            <button id="applyCustomPresetBtn" class="btn btn-glass" type="button">Apply Custom</button>
          </div>
        </div>

        <div class="session-tag-controls">
          <label>
            Session tag
            <select id="sessionTagSelect">
              <option value="Algorithms">Algorithms</option>
              <option value="Revision">Revision</option>
              <option value="Bible reading">Bible reading</option>
              <option value="Class notes">Class notes</option>
              <option value="Prayer">Prayer</option>
              <option value="Custom">Custom</option>
            </select>
          </label>
          <label id="customTagRow" class="hidden">
            Custom tag
            <input id="customTagInput" type="text" maxlength="30" placeholder="e.g. Exam prep" />
          </label>
        </div>

        <div class="inline-actions">
          <button id="prepBeginBtn" class="btn btn-primary" type="button">Begin</button>
          <button id="prepSettingsBtn" class="btn btn-glass" type="button">Change Settings</button>
        </div>
      </div>

      <div id="versePopup" class="verse-popup hidden" role="status" aria-live="polite">
        <p class="popup-label">Scripture for this session</p>
        <blockquote id="popupVerseText" class="scripture-text"></blockquote>
        <p id="popupVerseRef" class="scripture-ref"></p>
        <p id="popupCountdown" class="popup-countdown"></p>
      </div>

      <div id="studySession" class="study-session hidden">
        <div class="session-top">
          <p id="phaseBadge" class="phase-badge study">Study</p>
          <p id="sessionStatus" class="session-status">Focus block in progress</p>
          <p id="sessionTagBadge" class="session-tag-badge">Tag: Algorithms</p>
        </div>
        <p id="focusLockStatus" class="focus-lock-status hidden"></p>

        <p id="timerDisplay" class="timer-display">25:00</p>

        <div class="timer-controls">
          <button id="startBtn" class="btn btn-primary" type="button">Start</button>
          <button id="pauseBtn" class="btn btn-glass" type="button">Pause</button>
          <button id="resetBtn" class="btn btn-glass" type="button">Reset</button>
          <button id="cancelSessionBtn" class="btn btn-danger" type="button">Cancel Session</button>
        </div>

        <article class="quote-card">
          <div class="quote-head">
            <p class="quote-label">Focus Scripture</p>
            <button id="studySaveVerseBtn" class="save-btn" type="button" aria-label="Save current verse to favourites">
              <span class="icon-wrap" aria-hidden="true">
                <svg viewBox="0 0 24 24" class="icon-svg" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 21s-7-4.35-9.1-8.14A5.3 5.3 0 0 1 12 4.5a5.3 5.3 0 0 1 9.1 8.36C19 16.65 12 21 12 21z" />
                </svg>
              </span>
              <span>Save</span>
            </button>
          </div>
          <blockquote id="sessionVerseText" class="scripture-text"></blockquote>
          <p id="sessionVerseRef" class="scripture-ref"></p>
          <p id="sessionEncouragementText" class="session-encouragement"></p>
        </article>

        <article class="notes-card">
          <div class="notes-head">
            <p class="quote-label">Study Notes</p>
            <button id="clearSessionNotesBtn" class="btn btn-glass notes-clear-btn" type="button">Clear</button>
          </div>

          <label class="notes-input-label" for="sessionNotesInput">Quick notes</label>
          <textarea id="sessionNotesInput" class="notes-textarea" placeholder="Write key points, ideas, or reminders..."></textarea>

          <p class="quote-label">Task list</p>
          <div class="todo-input-row">
            <input id="sessionTodoInput" type="text" maxlength="120" placeholder="Add a task for this study session" />
            <button id="addSessionTodoBtn" class="btn btn-primary" type="button">Add</button>
          </div>
          <ul id="sessionTodoList" class="todo-list"></ul>
        </article>
      </div>
    </section>

    <section id="analyticsSection" class="panel card hidden">
      <div class="panel-heading">
        <h2>Analytics</h2>
        <p>Daily output, total time, and streak consistency.</p>
      </div>

      <div class="stats-grid">
        <article class="stat-card">
          <p class="stat-label">Today</p>
          <p id="todayMinutes" class="stat-value">0 min</p>
        </article>
        <article class="stat-card">
          <p class="stat-label">Total Time</p>
          <p id="totalHours" class="stat-value">0.0 hrs</p>
        </article>
        <article class="stat-card">
          <p class="stat-label">Streak</p>
          <p id="streakDays" class="stat-value">0 days</p>
        </article>
        <article class="stat-card">
          <p class="stat-label">Study Days</p>
          <p id="studyDays" class="stat-value">0 days</p>
        </article>
        <article class="stat-card">
          <p class="stat-label">Goal Progress</p>
          <p id="goalProgress" class="stat-value">0 / 60 min</p>
        </article>
      </div>

      <article class="chart-card">
        <div class="chart-head">
          <h3>Weekly Plan Progress</h3>
          <p id="weeklyPlanSummary"></p>
        </div>
        <div class="plan-progress-track" aria-hidden="true">
          <div id="weeklyPlanProgressFill" class="plan-progress-fill"></div>
        </div>
        <div id="weeklyPlanBreakdown" class="weekly-plan-breakdown"></div>
      </article>

      <article class="chart-card">
        <div class="chart-head">
          <h3>Last 60 Days (minutes)</h3>
          <p id="chartSummary"></p>
        </div>
        <div id="studyGraph" class="study-graph" aria-label="Study minutes graph"></div>
      </article>

      <article class="chart-card">
        <div class="chart-head">
          <h3>Weekly Time by Tag</h3>
          <p id="tagSummary"></p>
        </div>
        <div id="tagBreakdownList" class="tag-breakdown-list"></div>
      </article>

      <article class="chart-card">
        <div class="chart-head">
          <h3>Deep Insights</h3>
          <p id="deepInsightsSummary"></p>
        </div>
        <div id="deepInsightsList" class="insights-list"></div>
        <div id="tagTrendList" class="tag-trend-list"></div>
      </article>

      <article class="chart-card">
        <div class="chart-head">
          <h3>Achievements</h3>
          <p id="achievementSummary">0 / 13 unlocked</p>
        </div>
        <div id="achievementsGrid" class="achievements-grid" aria-label="Streak achievements"></div>
      </article>
    </section>

    <section id="settingsSection" class="panel card hidden">
      <div class="panel-heading">
        <h2>Settings</h2>
        <p>Clear controls for session timing, reminders, focus, and audio.</p>
      </div>

      <div class="settings-layout">
        <aside class="settings-sidebar">
          <article class="settings-sidebar-card">
            <p class="settings-sidebar-kicker">Control Centre</p>
            <h3>Quick Navigation</h3>
            <p>Jump straight to each area and keep your setup easy to manage.</p>
            <nav class="settings-quick-nav" aria-label="Settings quick navigation">
              <button type="button" class="settings-quick-btn active" data-settings-target="settingsGeneralAnchor">General</button>
              <button type="button" class="settings-quick-btn" data-settings-target="settingsPlanAnchor">Planning</button>
              <button type="button" class="settings-quick-btn" data-settings-target="settingsFocusAnchor">Focus</button>
              <button type="button" class="settings-quick-btn" data-settings-target="settingsAudioAnchor">Audio</button>
              <button type="button" class="settings-quick-btn" data-settings-target="accountSettingsCard">Account</button>
            </nav>
          </article>
        </aside>

        <div class="settings-content">
          <form id="settingsForm" class="settings-form">
            <section class="settings-block">
              <span id="settingsGeneralAnchor" class="settings-anchor" aria-hidden="true"></span>
              <div class="settings-block-head">
                <h3 class="settings-block-title">General Session Setup</h3>
                <p class="settings-block-note">Set the default structure for your focus rhythm.</p>
              </div>
              <div class="settings-fields-grid">
                <label class="settings-field">
                  Study minutes
                  <input id="studyMinutesSetting" type="number" min="1" max="240" />
                </label>

                <label class="settings-field">
                  Break minutes
                  <input id="breakMinutesSetting" type="number" min="1" max="120" />
                </label>

                <label class="settings-field">
                  Daily goal minutes
                  <input id="dailyGoalMinutesSetting" type="number" min="10" max="600" />
                </label>
              </div>
            </section>

            <section class="settings-block">
              <span id="settingsPlanAnchor" class="settings-anchor" aria-hidden="true"></span>
              <div class="settings-block-head">
                <h3 class="settings-block-title">Planning & Reminders</h3>
                <p class="settings-block-note">Plan your weekly output and schedule gentle reminders.</p>
              </div>

              <details class="settings-subpanel settings-collapse weekly-plan-panel" open>
                <summary class="settings-subpanel-title">Weekly Study Plan (minutes)</summary>
                <div class="settings-collapse-body">
                  <div class="weekly-plan-grid">
                    <label>
                      Mon
                      <input id="weeklyPlanMonSetting" type="number" min="0" max="360" />
                    </label>
                    <label>
                      Tue
                      <input id="weeklyPlanTueSetting" type="number" min="0" max="360" />
                    </label>
                    <label>
                      Wed
                      <input id="weeklyPlanWedSetting" type="number" min="0" max="360" />
                    </label>
                    <label>
                      Thu
                      <input id="weeklyPlanThuSetting" type="number" min="0" max="360" />
                    </label>
                    <label>
                      Fri
                      <input id="weeklyPlanFriSetting" type="number" min="0" max="360" />
                    </label>
                    <label>
                      Sat
                      <input id="weeklyPlanSatSetting" type="number" min="0" max="360" />
                    </label>
                    <label>
                      Sun
                      <input id="weeklyPlanSunSetting" type="number" min="0" max="360" />
                    </label>
                  </div>
                  <p class="settings-subpanel-note">Weekly target auto-calculates from the daily plan above.</p>
                </div>
              </details>

              <details class="settings-subpanel settings-collapse reminder-panel" open>
                <summary class="settings-subpanel-title">Study Reminder</summary>
                <div class="settings-collapse-body">
                  <div class="settings-subpanel-head">
                    <p class="settings-subpanel-note">Reminder notifications while the app is open.</p>
                    <label class="toggle-switch" for="remindersEnabledSetting">
                      <input id="remindersEnabledSetting" type="checkbox" />
                      <span class="toggle-switch-track" aria-hidden="true"></span>
                      <span class="toggle-switch-text">Enabled</span>
                    </label>
                  </div>
                  <div class="reminder-grid">
                    <label>
                      Reminder time
                      <input id="reminderTimeSetting" type="time" />
                    </label>
                    <label>
                      Quiet hours start
                      <input id="quietHoursStartSetting" type="time" />
                    </label>
                    <label>
                      Quiet hours end
                      <input id="quietHoursEndSetting" type="time" />
                    </label>
                  </div>
                  <button id="enableReminderPermissionBtn" type="button" class="btn btn-glass">Enable Notifications</button>
                </div>
              </details>
            </section>

            <section class="settings-block">
              <span id="settingsFocusAnchor" class="settings-anchor" aria-hidden="true"></span>
              <div class="settings-block-head">
                <h3 class="settings-block-title">Appearance & Focus</h3>
                <p class="settings-block-note">Choose your visual theme and how strict focus mode should be.</p>
              </div>
              <div class="settings-fields-grid">
                <div class="settings-field settings-theme-field">
                  <p class="settings-field-label">Color mode</p>
                  <div id="themeSetting" class="settings-theme-picker" role="radiogroup" aria-label="Color mode">
                    <label class="theme-option-card theme-option-midnight">
                      <input type="radio" name="themeSetting" value="dark" />
                      <span class="theme-option-swatch" aria-hidden="true"></span>
                      <span class="theme-option-copy">
                        <strong>Midnight</strong>
                        <small>Deep and calm</small>
                      </span>
                    </label>
                    <label class="theme-option-card theme-option-pearl">
                      <input type="radio" name="themeSetting" value="light" />
                      <span class="theme-option-swatch" aria-hidden="true"></span>
                      <span class="theme-option-copy">
                        <strong>Pearl</strong>
                        <small>Clean and bright</small>
                      </span>
                    </label>
                    <label class="theme-option-card theme-option-ember">
                      <input type="radio" name="themeSetting" value="dawn" />
                      <span class="theme-option-swatch" aria-hidden="true"></span>
                      <span class="theme-option-copy">
                        <strong>Ember</strong>
                        <small>Warm and focused</small>
                      </span>
                    </label>
                    <label class="theme-option-card theme-option-azure">
                      <input type="radio" name="themeSetting" value="ocean" />
                      <span class="theme-option-swatch" aria-hidden="true"></span>
                      <span class="theme-option-copy">
                        <strong>Azure</strong>
                        <small>Cool and clear</small>
                      </span>
                    </label>
                    <label class="theme-option-card theme-option-forest">
                      <input type="radio" name="themeSetting" value="sage" />
                      <span class="theme-option-swatch" aria-hidden="true"></span>
                      <span class="theme-option-copy">
                        <strong>Forest</strong>
                        <small>Natural and steady</small>
                      </span>
                    </label>
                  </div>
                </div>

                <label class="settings-field">
                  Focus mode
                  <select id="focusModeSetting">
                    <option value="partial">Partial focus (gentle reminders)</option>
                    <option value="complete">Complete focus (strict mode)</option>
                  </select>
                </label>
              </div>

              <details class="settings-subpanel settings-collapse lockin-panel">
                <summary class="settings-subpanel-title">Lock-In Mode (Complete Focus)</summary>
                <div class="settings-collapse-body">
                  <label>
                    Commitment minutes (0 to disable)
                    <input id="focusCommitMinutesSetting" type="number" min="0" max="240" />
                  </label>
                  <label>
                    Blocked site reminders (one per line)
                    <textarea id="blockedSitesSetting" rows="3" placeholder="youtube.com&#10;x.com&#10;instagram.com"></textarea>
                  </label>
                  <p class="settings-subpanel-note">Sanctuary cannot block other websites at browser/system level, but lock-in guards exits and asks for break-glass confirmation with these domains.</p>
                </div>
              </details>
            </section>

            <section class="settings-block">
              <span id="settingsAudioAnchor" class="settings-anchor" aria-hidden="true"></span>
              <div class="settings-block-head">
                <h3 class="settings-block-title">Audio & Music</h3>
                <p class="settings-block-note">Configure alarm behavior and background audio sources.</p>
              </div>
              <div class="settings-fields-grid">
                <label class="settings-field">
                  Alarm sound
                  <select id="alarmModeSetting">
                    <option value="mixkit_chime">Mixkit Quick Chime</option>
                    <option value="mixkit_facility">Mixkit Facility Alarm</option>
                    <option value="mixkit_spaceship">Mixkit Spaceship Alarm</option>
                    <option value="mixkit_waiting">Mixkit Waiting Ringtone</option>
                    <option value="commons">Free API random (Wikimedia)</option>
                    <option value="soft">Soft tone</option>
                    <option value="bell">Bell tone</option>
                    <option value="custom">Custom URL</option>
                  </select>
                </label>

                <label id="customAlarmRow" class="settings-field hidden">
                  Custom alarm URL
                  <input id="customAlarmUrlSetting" type="url" placeholder="https://example.com/alarm.mp3" />
                </label>

                <label class="settings-field youtube-music-row">
                  Music URL (YouTube or direct MP3/WAV)
                  <input id="youtubeMusicUrlSetting" type="url" placeholder="https://www.youtube.com/watch?v=... or https://.../track.mp3" />
                </label>

                <label class="settings-field">
                  Built-in lofi preset
                  <select id="lofiPresetSelect">
                    <option value="">None</option>
                  </select>
                </label>

                <label class="settings-field">
                  Or choose local audio file
                  <input id="localMusicFileInput" type="file" accept="audio/*" />
                </label>
              </div>

              <div class="settings-subpanel attribution-panel">
                <details class="attribution-dropdown">
                  <summary class="settings-subpanel-title">Music Attribution (FreeToUse)</summary>
                  <div class="attribution-dropdown-body">
                    <p class="settings-subpanel-note">Tracks below are used under Free To Use terms. Keep these attributions when publishing your content.</p>
                    <p class="settings-subpanel-note">License reminder: monetized user-generated content is allowed with attribution, while standalone commercial re-use is restricted by the Free License.</p>
                    <div class="attribution-scroll-wrap">
                      <ul id="musicAttributionList" class="music-attribution-list"></ul>
                    </div>
                  </div>
                </details>
              </div>

              <div class="settings-actions">
                <button type="submit" class="btn btn-primary">Save Settings</button>
                <button id="testAlarmBtn" type="button" class="btn btn-glass">Test Alarm</button>
                <button id="loadMusicBtn" type="button" class="btn btn-glass">Load Music</button>
                <button id="playMusic" type="button" class="btn btn-glass">Play Background Music</button>
                <button id="stopMusicBtn" type="button" class="btn btn-glass">Stop Music</button>
              </div>
            </section>
          </form>

          <div class="settings-meta-grid">
            <article id="accountSettingsCard" class="account-settings-card hidden">
              <h3>Account</h3>
              <p id="accountSettingsStatus" class="account-settings-status">Signed in account controls.</p>
              <div class="account-settings-actions">
                <button id="settingsSignOutBtn" type="button" class="btn btn-glass">Sign Out</button>
                <button id="settingsDeleteAccountBtn" type="button" class="btn btn-danger">Delete Account</button>
              </div>
            </article>

            <article id="syncStatusCard" class="sync-status-card">
              <h3>Sync Status</h3>
              <div class="sync-status-line">
                <span id="syncStatusDot" class="sync-status-dot" aria-hidden="true"></span>
                <p id="syncStatusPrimary" class="sync-status-primary">Sign in to enable cloud sync.</p>
              </div>
              <p id="syncStatusSecondary" class="sync-status-secondary">Last synced: --</p>
            </article>
          </div>

          <p id="settingsMessage" class="settings-message" role="status" aria-live="polite"></p>
        </div>
      </div>
    </section>

    <section id="favouritesSection" class="panel card hidden">
      <div class="panel-heading">
        <h2>Sanctuary Favourites</h2>
        <p>Saved scriptures and encouragements for future sessions.</p>
      </div>

      <div id="favouritesList" class="favourites-list"></div>
    </section>

    <footer class="app-footer" role="contentinfo">
      <div class="app-footer-left">
        <div class="app-footer-brand">
          <span class="app-footer-dot" aria-hidden="true"></span>
          <span>Sanctuary Labs</span>
        </div>
        <p class="app-footer-meta">Created by Sanctuary Labs Â· 2026</p>
      </div>
      <nav class="app-footer-links" aria-label="Legal links">
        <a href="./privacy.html">Privacy Policy</a>
        <a href="./terms.html">Terms of Use</a>
      </nav>
    </footer>
  </main>

  <aside id="miniTimerWidget" class="mini-timer hidden" aria-live="polite">
    <p id="miniTimerPhase" class="mini-timer-phase">Study</p>
    <p id="miniTimerTime" class="mini-timer-time">25:00</p>
    <button id="miniTimerGoBtn" class="mini-timer-btn" type="button">Open Study</button>
  </aside>

  <aside id="musicDock" class="music-dock hidden">
    <div class="music-dock-head">
      <p id="musicDockTitle">Background Music</p>
      <div class="music-dock-actions">
        <button id="musicDockMinBtn" class="music-dock-icon-btn music-dock-min" type="button" aria-label="Minimize music player" title="Minimize music player">
          <span class="icon-wrap" data-icon="minimize" aria-hidden="true">
            <svg viewBox="0 0 24 24" class="icon-svg" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M5 12h14" />
            </svg>
          </span>
          <span class="icon-wrap hidden" data-icon="expand" aria-hidden="true">
            <svg viewBox="0 0 24 24" class="icon-svg" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 9V3h6M21 9V3h-6M3 15v6h6M21 15v6h-6" />
            </svg>
          </span>
        </button>
        <button id="musicDockPlayPauseBtn" class="music-dock-icon-btn music-dock-playpause" type="button" aria-label="Play music" title="Play music">
          <span class="icon-wrap" data-icon="play" aria-hidden="true">
            <svg viewBox="0 0 24 24" class="icon-svg" fill="currentColor" stroke="none">
              <path d="M8 6v12l10-6z" />
            </svg>
          </span>
          <span class="icon-wrap hidden" data-icon="pause" aria-hidden="true">
            <svg viewBox="0 0 24 24" class="icon-svg" fill="currentColor" stroke="none">
              <path d="M8 6h3v12H8zM13 6h3v12h-3z" />
            </svg>
          </span>
        </button>
        <button id="musicDockCloseBtn" class="music-dock-icon-btn music-dock-close" type="button" aria-label="Stop and close music" title="Stop and close music">
          <span class="icon-wrap" aria-hidden="true">
            <svg viewBox="0 0 24 24" class="icon-svg" fill="currentColor" stroke="none">
              <path d="M7 7h10v10H7z" />
            </svg>
          </span>
        </button>
      </div>
    </div>
    <p id="musicDockLabel" class="music-dock-label"></p>
    <button id="musicOpenExternalBtn" class="music-open-external hidden" type="button">Open on YouTube</button>
    <div id="musicFrameWrap" class="music-frame-wrap hidden">
      <div id="musicFrame" class="music-frame" role="region" aria-label="YouTube background music player"></div>
    </div>
    <div id="audioPlayerWrap" class="audio-player-wrap hidden">
      <audio id="bg-audio" controls preload="none" loop></audio>
    </div>
  </aside>

  <aside id="motivationToast" class="motivation-toast hidden" role="status" aria-live="polite"></aside>

  <aside id="achievementToast" class="achievement-toast hidden" role="status" aria-live="polite">
    <div id="achievementToastMedal" class="achievement-toast-medal">1</div>
    <div class="achievement-toast-copy">
      <p class="achievement-toast-kicker">Achievement Unlocked</p>
      <p id="achievementToastTitle" class="achievement-toast-title"></p>
      <p id="achievementToastMessage" class="achievement-toast-message"></p>
    </div>
  </aside>

  <aside id="sessionReviewPrompt" class="session-review-prompt hidden" role="dialog" aria-live="polite" aria-label="Session review">
    <p class="session-review-title">How did that study block feel?</p>
    <div class="session-review-actions">
      <button id="reviewFocusedBtn" type="button" class="btn btn-primary">Focused</button>
      <button id="reviewDistractedBtn" type="button" class="btn btn-glass">Distracted</button>
      <button id="reviewSkipBtn" type="button" class="btn btn-glass">Later</button>
    </div>
  </aside>

  <div id="popupOverlay" class="popup-overlay hidden" aria-hidden="true"></div>

  <div id="cancelSessionModal" class="cancel-session-modal hidden" role="dialog" aria-modal="true" aria-labelledby="cancelSessionTitle" aria-describedby="cancelSessionMessage">
    <div class="cancel-session-card">
      <h3 id="cancelSessionTitle">Cancel study session?</h3>
      <p id="cancelSessionMessage">This block will not be tracked if you do not finish the full study block. Do you still want to cancel?</p>
      <div class="cancel-session-actions">
        <button id="keepSessionBtn" class="btn btn-glass" type="button">Keep Session</button>
        <button id="confirmCancelSessionBtn" class="btn btn-danger" type="button">Yes, Cancel</button>
      </div>
    </div>
  </div>

  <div id="focusExitModal" class="cancel-session-modal hidden" role="dialog" aria-modal="true" aria-labelledby="focusExitTitle" aria-describedby="focusExitMessage">
    <div class="cancel-session-card focus-exit-card">
      <h3 id="focusExitTitle">Break glass and exit focus?</h3>
      <p id="focusExitMessage">A lock-in commitment is active. Leaving now will end strict focus for this commitment.</p>
      <div id="focusBlockedSitesList" class="focus-blocked-sites-list hidden"></div>
      <div class="cancel-session-actions">
        <button id="keepFocusBtn" class="btn btn-primary" type="button">Stay Focused</button>
        <button id="breakGlassBtn" class="btn btn-danger" type="button">Break Glass & Exit</button>
      </div>
    </div>
  </div>

  <script src="./js/constants.js?v=20260221-ios-fix2"></script>
  <script src="./js/sync.js?v=20260221-ios-fix2"></script>
  <script src="./js/analytics.js?v=20260221-ios-fix2"></script>
  <script src="./js/ui.js?v=20260221-ios-fix2"></script>
  <script src="./js/timer.js?v=20260221-ios-fix2"></script>
  <script src="./js/music.js?v=20260221-ios-fix2"></script>
  <script type="module" src="./auth.js?v=20260221-ios-fix2"></script>
  <script src="./app.js?v=20260221-ios-fix2"></script>
</body>
</html>
